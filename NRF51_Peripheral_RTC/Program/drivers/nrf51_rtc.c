/*=====================================================================================================*/
/*=====================================================================================================*/
#include "nrf51_system.h"
#include "nrf51_clock.h"
#include "nrf51_rtc.h"
/*====================================================================================================*/
/*====================================================================================================*
**函數 : RTC_Init
**功能 : RTC Init
**輸入 : None
**輸出 : None
**使用 : RTC_Init(RTCx, &RTC_InitStruct);
**====================================================================================================*/
/*====================================================================================================*/
void RTC_Init( NRF_RTC_Type *RTCx, RTC_InitTypeDef *RTC_InitStruct )
{
  uint32_t tmpReg[2] = {0};

  RTCx->PRESCALER                   = RTC_InitStruct->Prescaler;
  RTCx->CC[RTC_InitStruct->Channel] = RTC_InitStruct->Period;

  tmpReg[0] = RTCx->EVTENSET | RTC_EVTENSET_TICK_Msk;
  tmpReg[1] = RTCx->INTENSET | RTC_INTENSET_TICK_Msk;

  switch(RTC_InitStruct->Channel) {
    case RTC_CH0:
      tmpReg[0] |= RTC_EVTENSET_COMPARE0_Msk;
      tmpReg[1] |= RTC_INTENSET_COMPARE0_Msk;
      break;
    case RTC_CH1:
      tmpReg[0] |= RTC_EVTENSET_COMPARE1_Msk;
      tmpReg[1] |= RTC_INTENSET_COMPARE1_Msk;
      break;
    case RTC_CH2:
      tmpReg[0] |= RTC_EVTENSET_COMPARE2_Msk;
      tmpReg[1] |= RTC_INTENSET_COMPARE2_Msk;
      break;
    case RTC_CH3:
      tmpReg[0] |= RTC_EVTENSET_COMPARE3_Msk;
      tmpReg[1] |= RTC_INTENSET_COMPARE3_Msk;
      break;
  }

  RTCx->EVTENSET = tmpReg[0];
  RTCx->INTENSET = tmpReg[1];
}
/*====================================================================================================*/
/*====================================================================================================*
**函數 : RTC_CntClear
**功能 : Counter Clear
**輸入 : NewState
**輸出 : None
**使用 : RTC_Cmd(RTCx, ENABLE);
**====================================================================================================*/
/*====================================================================================================*/
void RTC_Cmd( NRF_RTC_Type *RTCx, uint8_t state )
{
  if(state == SUCCESS)
    RTCx->TASKS_START = 1;
  else
    RTCx->TASKS_STOP = 1;
}
/*====================================================================================================*/
/*====================================================================================================*
**函數 : RTC_CntClear
**功能 : Counter Clear
**輸入 : None
**輸出 : None
**使用 : RTC_CntClear(RTCx);
**====================================================================================================*/
/*====================================================================================================*/
void RTC_CntClear( NRF_RTC_Type *RTCx )
{
  RTCx->TASKS_CLEAR = 1;
}
/*====================================================================================================*/
/*====================================================================================================*
**函數 : RTC_TickEvenCheck
**功能 : Tick Even Check
**輸入 : None
**輸出 : State
**使用 : State = RTC_TickEvenCheck(RTCx);
**====================================================================================================*/
/*====================================================================================================*/
uint8_t RTC_TickEvenCheck( NRF_RTC_Type *RTCx )
{
  return ((RTCx->EVENTS_TICK == 1) ? SUCCESS : ERROR);
}
/*====================================================================================================*/
/*====================================================================================================*
**函數 : RTC_TickEvenClear
**功能 : Tick Even Clear
**輸入 : None
**輸出 : None
**使用 : RTC_TickEvenClear(RTCx);
**====================================================================================================*/
/*====================================================================================================*/
void RTC_TickEvenClear( NRF_RTC_Type *RTCx )
{
  RTCx->EVENTS_TICK = 0;
}
/*====================================================================================================*/
/*====================================================================================================*
**函數 : RTC_CompEvenCheck
**功能 : RTC CC Even Check
**輸入 : RTC_CH
**輸出 : State
**使用 : State = RTC_CompEvenCheck(RTCx, RTCx_CH);
**====================================================================================================*/
/*====================================================================================================*/
uint8_t RTC_CompEvenCheck( NRF_RTC_Type *RTCx, RTC_CH_TypeDef RTCx_CH )
{
  return ((RTCx->EVENTS_COMPARE[RTCx_CH] == 1) ? SUCCESS : ERROR);
}
/*====================================================================================================*/
/*====================================================================================================*
**函數 : RTC_CompEvenClear
**功能 : RTC CC Even Clear
**輸入 : RTC_CH
**輸出 : State
**使用 : RTC_CompEvenClear(RTCx, RTCx_CH);
**====================================================================================================*/
/*====================================================================================================*/
void RTC_CompEvenClear( NRF_RTC_Type *RTCx, RTC_CH_TypeDef RTCx_CH )
{
  RTCx->EVENTS_COMPARE[RTCx_CH] = 0;
}
/*====================================================================================================*/
/*====================================================================================================*
**函數 : RTC_TickEnenCmd
**功能 : Enable / Disable Tick Even
**輸入 : NewState
**輸出 : None
**使用 : RTC_TickEnenCmd(ENABLE);
**====================================================================================================*/
/*====================================================================================================*/
//void RTC_TickEnenCmd( FunctionalState NewState )
//{
//  if(NewState == ENABLE)
//    NRF_RTC0->EVTENSET = RTC_EVTENSET_TICK_Enabled << RTC_EVTENSET_TICK_Pos;
//  else
//    NRF_RTC0->EVTENCLR = RTC_EVTENCLR_TICK_Enabled << RTC_EVTENCLR_TICK_Pos;
//}
/*====================================================================================================*/
/*====================================================================================================*
**函數 : RTC_TickIntCmd
**功能 : Enable / Disable Tick Interrupt
**輸入 : NewState
**輸出 : None
**使用 : RTC_TickIntCmd();
**====================================================================================================*/
/*====================================================================================================*/
//void RTC_TickIntCmd( FunctionalState NewState )
//{
//  if(NewState == ENABLE)
//    NRF_RTC0->INTENSET = RTC_INTENSET_TICK_Enabled << RTC_INTENSET_TICK_Pos;
//  else
//    NRF_RTC0->INTENCLR = RTC_INTENCLR_TICK_Enabled << RTC_INTENCLR_TICK_Pos;
//}
/*=====================================================================================================*/
/*=====================================================================================================*/
